<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="css/mui.min.css" rel="stylesheet" />
		<link href="css/setting.css" rel="stylesheet" />
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">设置</h1>
		</header>
		<div id="setting">
			<ul class="mui-table-view mui-table-view-chevron" style="margin-top: 60px;">
				<li class="mui-table-view-cell">
					<a id="goto_perData" href="#privacy" class="mui-navigate-right">个人资料</a>
				</li>
				<li class="mui-table-view-cell">
					<a class="mui-navigate-right">账号管理与绑定</a>
				</li>
			</ul>
			<ul class="mui-table-view">
				<li class="mui-table-view-cell">
					<a >清除缓存</a>
				</li>
				<li class="mui-table-view-cell">
					通知显示消息
					<div class="mui-switch mui-active mui-switch-mini mui-switch-blue">
						<div class="mui-switch-handle"></div>
					</div>
				</li>
			</ul>
			<ul class="mui-table-view mui-table-view-chevron">
				<li class="mui-table-view-cell">
					<a class="mui-navigate-right">
						关于解忧
						<i class="mui-pull-right update"></i>
					</a>
				</li>
				<li class="mui-table-view-cell">
					<a>分享好友</a>
				</li>
				<li class="mui-table-view-cell">
					<a class="mui-navigate-right">帮助与反馈</a>
				</li>
				<li class="mui-table-view-cell">
					<a>版本更新</a>
				</li>
			</ul>
			<div class=" logout">
				<button type="button" class="mui-table-view-cell mui-btn">{{isLogin}}</button>
			</div>
		</div>
		<script src="js/mui.min.js "></script>
		<script src="js/common.js"></script>
		<script src="js/vue.min.js"></script>
		<script type="text/javascript ">
			mui.init({
				swipeBack: true, //启用右滑关闭功能
			})

			mui.plusReady(function() {
				/*初始化页面数据*/

				//				var launch = myStorage.getItem("launchFlag");
				//				//var logbtnnode=document.getElementsByClassName("logout")[0].children[0];
				//				//console.log(typeof launch);
				//				if(launch == "true") {
				//					//logbtnnode.innerText = "退出登录";
				//					setting.isLogin = "退出登录";
				//				} else {
				//					//logbtnnode.innerText = "立即登录";
				//					setting.isLogin = "立即登录";
				//				}

				/*判断是否登录*/
				var launch = myStorage.getItem("isLogin");
				//var logbtnnode=document.getElementsByClassName("logout")[0].children[0];
				//console.log(typeof launch);
				if(launch == "true") {
					setting.isLogin = "退出登录";
					setting.isLoginOrLogout = true;
				} else {
					setting.isLoginOrLogout = false;
					setting.isLogin = "立即登录";
				}

				document.getElementById('goto_perData').addEventListener('tap', function() {
					mui.openWindow({
						url: 'perData.html',
						id: 'perData.html',
						waiting: {
							autoShow: true, //自动显示等待框，默认为true
							title: '加载中...', //等待对话框上显示的提示内容
							options: {
								width: "100px",
								height: "100px",
								color: "#ffffff",
								background: "rgba(0,0,0,0.4)",
								loading: {
									display: "block",
									height: "30px",
									icon: "images/logo.png"
								}
							}
						}
					})
				});

				mui("body").on("tap", ".logout button", function() {
					var loginFlag = myStorage.getItem("isLogin");
					//console.log(typeof launchFlag)
					if(loginFlag == "true") {
						this.innerText = "立即登录";
						mui.toast('退出登录成功！');
						
						myStorage.setItem("launchFlag", "false");
						myStorage.setItem('isLogin', "false");
						setting.isLoginOrLogout = false;
						
						//传值到我的页面
						var Webv_wode = plus.webview.getWebviewById("index-subpage-wode.html");
						Webv_wode.evalJS('updateIsLogin(false)');
						
					} else {
						this.innerText = "安全退出";
						mui.toast('登录成功！');
						
						myStorage.setItem("launchFlag", "true");
						myStorage.setItem('isLogin', "true");
						setting.isLoginOrLogout = true;
						
						//传值到我的页面
						var Webv_wode = plus.webview.getWebviewById("index-subpage-wode.html");
						Webv_wode.evalJS('updateIsLogin(true)');
						
					}
				})

				// 通知上个页面
//				var w = plus.webview.currentWebview();
//				var opener = w.opener();
//				mui.fire(opener, "isLogin", {
//					isLogin: setting.isLoginOrLogout
//				});

			})

			var setting = new Vue({
				el: '#setting',
				data: {
					isLogin: "",
					isLoginOrLogout: '',
				}
			});
		</script>
	</body>

</html>