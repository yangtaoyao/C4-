<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script type="text/javascript">
var websocket = null;
var username = localStorage.getItem("name");

//判断当前浏览器是否支持WebSocket  
if ('WebSocket' in window) {
	websocket = new WebSocket( "ws://localhost:8080/jieyou/websocket/"+Math.random());
} else {
	alert('当前浏览器 Not support websocket')
}

//连接发生错误的回调方法  
websocket.onerror = function() {
	setMessageInnerHTML("WebSocket连接发生错误");
};

//连接成功建立的回调方法  
websocket.onopen = function() {
	setMessageInnerHTML("WebSocket连接成功");
}

//接收到消息的回调方法  
websocket.onmessage = function(event) {
	setMessageInnerHTML(event.data);
}

//连接关闭的回调方法  
websocket.onclose = function() {
	setMessageInnerHTML("WebSocket连接关闭");
}

//监听窗口关闭事件，当窗口关闭时，主动去关闭websocket连接，防止连接还没断开就关闭窗口，server端会抛异常。  
window.onbeforeunload = function() {
	closeWebSocket();
}

//关闭WebSocket连接  
function closeWebSocket() {
	websocket.close();
}

function sendMessage() {
	websocket.send("发送消息");
}

//将消息显示在网页上
function setMessageInnerHTML(innerHTML) {
	document.getElementById('contract').innerHTML += innerHTML + '<br/>';
}

//关闭WebSocket连接
function closeWebSocket() {
	websocket.close();
}

//发送消息
function send() {
	var message = document.getElementById('text').value;
	websocket.send(message);
}

var sessionId='';

function login(id){
	var form = document.getElementById(id);
	var elements = new Array();
	var tagElements = form.getElementsByTagName('input');
	var data='';
	for (var i = 0; i < tagElements.length; i++) {
		console.log(tagElements[i].getAttribute('name'));
		var name = tagElements[i].getAttribute('name');
		var value = tagElements[i].getAttribute('value');
		if (name != null)
			data+=value+'&';
	}
	var xmlhttp;
	if (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari
		xmlhttp = new XMLHttpRequest();
	} else {// code for IE6, IE5
		xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
	}
	xmlhttp.onreadystatechange = function() {
		console.log(xmlhttp.readyState + '' + xmlhttp.status == 200);
		if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
			sessionId=xmlhttp.getResponseHeader("JSESSIONID");
			alert(sessionId);
		}
	}
	alert(xmlhttp);
	xmlhttp.open("POST", 'http://localhost:8080/jieyou/doLogin', true);
	xmlhttp.send(data);
}

	function register(formId,url) {
		var form = document.getElementById(formId);
		var elements = new Array();
		var tagElements = form.getElementsByTagName('input');
		var jsonObject = new Object;
		for (var i = 0; i < tagElements.length; i++) {
			console.log(tagElements[i].getAttribute('name'));
			var name = tagElements[i].getAttribute('name');
			var value = tagElements[i].getAttribute('value');
			if (name != null)
				jsonObject[name] = value;
		}
		var xmlhttp;
		if (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari
			xmlhttp = new XMLHttpRequest();
		} else {// code for IE6, IE5
			xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
		}
		xmlhttp.onreadystatechange = function() {
			console.log(xmlhttp.readyState + '' + xmlhttp.status == 200);
			if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
			}
		}
		alert(sessionId);
		xmlhttp.open("POST", url, true);
		xmlhttp.setRequestHeader("Cookie", "JSESSIONID="+sessionId);
		xmlhttp.setRequestHeader("content-type", "application/json");
		xmlhttp.send(JSON.stringify(jsonObject));
	}
	
	var pagestart=0;
	var page=3;
	function getTask(category){
		var xmlhttp;
		if (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari
			xmlhttp = new XMLHttpRequest();
		} else {// code for IE6, IE5
			xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
		}
		xmlhttp.onreadystatechange = function() {
			if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
				handleTask(xmlhttp.responseText,'task'+category);
			}
		}
		alert(xmlhttp);
		url='http://localhost:8080/jieyou/user?action=getTaskInfo&category='+category;
		xmlhttp.open("GET", url, true);
		xmlhttp.send();
	}
	
	function handleTask(response,divId){
		var div = document.getElementById(divId);
		div.innnerHTML=response;
	}
	
	function sendForm(e,url) {
		var elements = new Array();
		var tagElements = e.getElementsByTagName('input');
		var data = '';
		for (var i = 0; i < tagElements.length; i++) {
			var value = tagElements[i].getAttribute('value');
			data=value+"&";
		}
		var xmlhttp;
		if (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari
			xmlhttp = new XMLHttpRequest();
		} else {// code for IE6, IE5
			xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
		}
		xmlhttp.onreadystatechange = function() {
			console.log(xmlhttp.readyState + '' + xmlhttp.status == 200);
			if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
			}
		}
		alert(xmlhttp);
		xmlhttp.open("POST", url, true);
		xmlhttp.setRequestHeader("Cookie", "JSESSIONID="+sessionId);
		xmlhttp.send(data);
		alert(data);
	}
	
	function access() {
		var e = document.getElementById('accessInput');
		var xmlhttp;
		if (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari
			xmlhttp = new XMLHttpRequest();
		} else {// code for IE6, IE5
			xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
		}
		xmlhttp.onreadystatechange = function() {
			console.log(xmlhttp.readyState + '' + xmlhttp.status == 200);
			if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
			}
		}
		alert(xmlhttp)
		var url="";
		xmlhttp.open("post",url+e.getAttribute("value") , true);
		xmlhttp.send();
	}

</script>
<style>
div{
	margin-left:50%;
}
</style>
</head>
<body>
	
	<input type="text" id="text" value="123" />
	<input type="button" value="发送" onclick="sendMessage()" />
	<div id="contract"></div>
	<div>
		注册:
		<form id="rs" action=""
			method="post">
			昵称:<input type="text" name="nickname" value="123" /> <br />
			密码:<input type="password" name="pwd" value="123" /> <br />
		       生日:<input type="text" name="birthday" value="1889-10-10 10:10:10" /> <br />
		       电话:<input type="text" name="tel" value="123" /> <br />
		  	<input type="submit" value="提交" onclick="register('rs','doRegister')"/>
		</form>
	</div>
	<div>
		登录：
		<form id="login" action="http://localhost:8080/jieyou/doLogin"
			method="post">
			uid:<input type="text" name="uid" value="123" /> <br />
			密码:<input type="password" name="pwd" value="123" /> <br />>
		  	<input type="submit" value="提交"/>
		</form>	
	</div>
	<div>
		发布任务:
		<form id="pt" action="http://localhost:8080/jieyou/task?action=publish"
			method="post" ENCTYPE="multipart/form-data">
			标签:<input type="text" name="label" value="123" /> <br />
			描述:<input type="text" name="content" value="123" /> <br />
		    过期时间:<input type="text" name="expireTime" value="1889-10-10 10:10:10" /> <br />
		    价格:<input type="text" name="price" value="123" /> <br />
		    图片:<input type="file" name="p1" multiple/>
		  <input type="submit" value="提交" onclick="register('pt','msg?action=publish')"/>
		</form>
	</div>
	
	<div>
	发布MSG:
		<form action="http://localhost:8080/jieyou/msg?action=publish"
			method="post"  ENCTYPE="multipart/form-data">
			内容:<input type="text" name="content" value="123" /> <br />
		       图片:<input type="file" name="p1" multiple/>
		  <input type="submit" value="提交"/>
		</form>
	</div>
	
	<div>
	获取Msg:
		<input id="getmsg" type="submit" value="提交" onclick="javascript:getMore"/>
	</div>
	
	<div class="msg"></div>
	
	<div>
	喜欢一个msg:
		<form id="love" action="http://localhost:8080/jieyou/msg?action=love"
			method="post">
			内容:<input type="text" name="mid" value="123" /> <br />
		  	<input type="submit" value="提交"/>
		</form>	
	</div>
	
	<div>
		更改信息:
		<form  action="http://localhost:8080/jieyou/user?action=changeInfo"
			method="post">
			昵称:<input type="text" name="nickname" value="123" /> <br />
		       生日:<input type="text" name="birthday" value="1889-10-10 10:10:10" /> <br />
		       电话:<input type="text" name="tel" value="123" /> <br />
		  	<input type="submit" value="提交" />
		</form>
	</div>
	
	<div>
		更改密码:
		<form id="rs" action="http://49.140.97.151:8080/jieyou/user?action=changePwd"
			method="post">
			昵称:<input type="password" name="pwd" value="12345" /> <br />
		  	<input type="submit" value="提交"/>
		</form>
	</div>
	
	<div>
		获取发布的任务
		<div id="task0"></div>
		<button onclick='getTask(0);'>获取</button>
	</div>
	
	<div>
		获取进行中的任务
		<div id="task1"></div>
		<button onclick='getTask(1);'>获取</button>
	</div>
	
	<div>
		获取完成了的的任务
		<div id="task2"></div>
		<button onclick='getTask(2);'>获取</button>
	</div>
		<div>
		访问:
		<form id="access" action="http://localhost:8080/jieyou/task?action=access"
			method="post">
			tid:<input type="text" name="tid" value="12345" id = "accessInput"/> <br />
		  	<input type="submit" value="提交" onclick="access()"/>
		</form>
	</div>
	
		</div>
	<div>
		访问:
		<form id="receive" action="http://localhost:8080/jieyou/task?action=recieve"
			method="post">
			tid:<input type="text" name="tid" value="12345" id = "accessInput"/> <br />
		  	<input type="submit" value="提交" />
		</form>
	</div>
	
		<div>
		获取:
		<form id="receive" action="http://localhost:8080/jieyou/task?action=hot"
			method="post">
			tid:<input type="text" name="pagestart" value="0" id = "accessInput"/> <br />
			<input type="text" name="page" value="3" id = "accessInput"/> <br />
		  	<input type="submit" value="提交" />
		</form>
	</div>
	
			<div>
		获取:
		<form id="receive" action="http://localhost:8080/jieyou/task?action=hot"
			method="post">

			<input type="text" name="page" value="3" id = "accessInput"/> <br />
		  	<input type="submit" value="提交" />
		</form>
	</div>
	
</body>
</html>